@model IEnumerable<DotNetProject.Models.Episode>
@{
    ViewData["Title"] = "Episodes";
    var fallbackImage = "https://wallpapers.com/images/hd/friends-tv-show-characters-8t1z1sj8k7wh4i0v.jpg";
}

<h1 class="page-title">Episodes</h1>

<div class="mb-4">
    <a asp-action="Create" class="btn-neon btn-neon-success">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="m9 8 6 4-6 4Z"/></svg>
        Add New Episode
    </a>
</div>

<div class="row g-4">
    @foreach (var item in Model)
    {
        var heroImage = string.IsNullOrWhiteSpace(item.ImageUrl) ? fallbackImage : item.ImageUrl;
        var videoLink = !string.IsNullOrWhiteSpace(item.VideoUrl)
            ? item.VideoUrl
            : $"https://www.youtube.com/embed?listType=search&list={System.Net.WebUtility.UrlEncode(item.EpisodeCode + " Friends")}";
        var descriptionPreview = string.IsNullOrWhiteSpace(item.Description)
            ? "No description available yet."
            : (item.Description.Length > 140 ? item.Description[..140] + "..." : item.Description);

        <div class="col-lg-6 animate-item">
            <div class="glass-card h-100 d-flex flex-column">
                <div class="media-banner">
                    <img class="media-img" src="@heroImage" alt="@item.Title" loading="lazy" onerror="this.onerror=null;this.src='@fallbackImage';" />
                    <div class="media-gradient"></div>
                    <span class="badge badge-glow">@item.EpisodeCode</span>
                    <div class="media-banner__title">
                        <h4>@item.Title</h4>
                        <small>Air date: @(item.AirDate?.ToString("MMM dd, yyyy") ?? "N/A")</small>
                    </div>
                </div>

                <p class="mt-3" style="color: var(--text-secondary);">@descriptionPreview</p>

                <div class="action-buttons mt-auto">
                    <a asp-action="Details" asp-route-id="@item.Id" class="btn-neon btn-neon-secondary" style="padding: 0.5rem 1rem; font-size: 0.8rem;">View</a>
                    <a asp-action="Edit" asp-route-id="@item.Id" class="btn-neon btn-neon-primary" style="padding: 0.5rem 1rem; font-size: 0.8rem;">Edit</a>
                    <a asp-action="Delete" asp-route-id="@item.Id" class="btn-neon btn-neon-danger" style="padding: 0.5rem 1rem; font-size: 0.8rem;">Delete</a>
                    <a href="@videoLink" target="_blank" rel="noopener" class="btn-neon btn-neon-purple" style="padding: 0.5rem 1rem; font-size: 0.8rem;">Watch clip</a>
                </div>
            </div>
        </div>
    }
</div>

@if (!Model.Any())
{
    <div class="glass-card text-center py-5">
        <div style="font-size: 4rem; opacity: 0.3; margin-bottom: 1rem;">ðŸŽ¬</div>
        <p style="color: var(--text-muted); font-size: 1.1rem;">No episodes found.</p>
        <a asp-action="Create" class="btn-neon btn-neon-primary mt-3">Add First Episode</a>
    </div>
}
